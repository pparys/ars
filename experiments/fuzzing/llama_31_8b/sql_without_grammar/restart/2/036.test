set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-table-foreign-keys-3.0 {
  execsql {
    CREATE TABLE employees(id INTEGER, name TEXT);
    CREATE TABLE departments(id INTEGER, department TEXT);
    CREATE TABLE employee_departments(
      employee_id INTEGER,
      department_id INTEGER,
      PRIMARY KEYmployee_id, department_id)
  ;
  INSERT INTO employees(id, name) VALUES(201, 'John');
  INSERT INTO employees(id, name) VALUES(202, 'Jane');
  INSERT INTO departments(id, department) VALUES(1, 'HR');
  INSERT INTO departments(id, department) VALUES(2, 'IT');
  INSERT INTO employee_departments(employee_id, department_id) 
    VALUES(201, 1);
}
} {}

do_test update-foreign-key-violation-3.1 {
  execsql {
    UPDATE departments SET department = 'Sales' WHERE id = 1;
    UPDATE employee_departments
    SET department_id = 2 WHERE employee_id = 201;
  }
} {0}

finish_test