set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-index-3.0 {
  execsql {
    CREATE TABLE orders(user_id INTEGER, order_id INTEGER, total REAL, rdate TEXT);
    CREATE TABLE order_details(order_id INTEGER, item_name TEXT, quantity INTEGER);
    CREATE TABLE users(user_id INTEGER, user_name TEXT, balance REAL);
    INSERT INTO users(user_id, user_name, balance) VALUES(101, 'Alice', 1000);
    INSERT INTO users(user_id, user_name, balance) VALUES(102, 'John', 800);
    INSERT INTO orders(user_id, order_id, total, rdate) VALUES(101, 1001, 50, '2022-01-01');
    INSERT INTO orders(user_id, order_id, total, rdate) VALUES(101, 1002, 30, '2022-01-15');
    INSERT INTO order_details(order_id, item_name, quantity) VALUES(1001, 'Book', 3);
    INSERT INTO order_details(order_id, item_name, quantity) VALUES(1001, 'Pen', 2);
    INSERT INTO order_details(order_id, item_name, quantity) VALUES(1002, 'Pencil', 5);
    INSERT INTO order_details(order_id, item_name, quantity) VALUES(1002, 'Notebook', 4);
  }
} {}

do_test select-total-order-3.1 {
  execsql {
    SELECT SUMtotal FROM orders WHERE user_id = 101;
  }
} {80.0}

finish_test