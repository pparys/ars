set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-indices-3.0 {
  execsql {
    CREATE TABLE books(id INTEGER, title TEXT, author TEXT);
    CREATE TABLE orders(id INTEGER, book_id INTEGER, order_date TEXT);
    CREATE TABLE order_details(id INTEGER, order_id INTEGER, sku TEXT);
    CREATE TABLE remit(id INTEGER, order_id INTEGER, shipment_date TEXT);
    CREATE TABLE baskets(id INTEGER, product_id INTEGER);
    CREATE TABLE cart_items(id INTEGER, basket_id INTEGER, quantity INTEGER);

    INSERT INTO books(id, title, author) VALUES(1001, 'Title1', 'Author1');
    INSERT INTO books(id, title, author) VALUES(1002, 'Title2', 'Author2');

    INSERT INTO orders(id, book_id, order_date) VALUES(101, 1001, '2022-01-01');
    INSERT INTO orders(id, book_id, order_date) VALUES(102, 1001, '2022-01-02');

    INSERT INTO order_details(id, order_id, sku) VALUES(201, 101, 'SKU01');
    INSERT INTO order_details(id, order_id, sku) VALUES(202, 101, 'SKU02');
    INSERT INTO order_details(id, order_id, sku) VALUES(203, 102, 'SKU01');

    INSERT INTO remit(id, order_id, shipment_date) VALUES(301, 101, '2022-01-05');
    INSERT INTO remit(id, order_id, shipment_date) VALUES(302, 102, '2022-01-06');
    INSERT INTO remit(id, order_id, shipment_date) VALUES(303, 102, '2022-01-06');

    INSERT INTO baskets(id, product_id) VALUES(501, 1001);
    INSERT INTO baskets(id, product_id) VALUES(502, 1001);

    INSERT INTO cart_items(id, basket_id, quantity) VALUES(601, 501, 3);
  }
} {}

do_test get-heavy-book-order-3.1 {
  execsql {
    SELECT orders_book_id FROM orders
    WHERE id = 102;
  }
} {1001}

finish_test