set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-check-1.0 {
  execsql {
    CREATE TABLE orders(
      id INTEGER PRIMARY KEY,
      customer_id INTEGER,
      order_date TEXT,
      total REAL,
      CHECK	order_date IS NOT NULL,
      CHECK	orders_total_paid_total_diff IS NOT NULL
    );

    CREATE TABLE orders_total_paid(
      id INTEGER,
      order_id INTEGER,
      total_diff REAL,
      FOREIGN KEY orders_total_paid_order_id REFERENCES orders ON DELETE CASCADE
    );

    INSERT INTO orders(id, customer_id, order_date, total) 
      VALUES(1, 2, '2021-01-01 00:00:00', 100.0);
  }
} {}

do_test insert-violates-check-1.1 {
  execsql {
    UPDATE orders 
    SET order_date = '2021-02-16 18:20:30' WHERE id = 1;

    DELETE FROM orders_total_paid WHERE id = 1;

    UPDATE orders 
    SET order_date = '' WHERE id = 1;

    UPDATE orders_total_paid 
    SET total_diff = NULL WHERE id = 1;

    UPDATE orders 
    SET total = NULL WHERE id = 1;
  }
  } {1 {CHECK constraint failed: orders}  





      
         





      
         





      
         





      
         





      
         





      
         





      
         





      
         





      
         





      
         





      
  





      
         





      
         





      
         





      
  





      
         





      
         





      
     





      
         





      
         





      
         





      
     





      

       





      
         





      
         





      
         





      
         





      
        





      
     





       





      
  





      
         





      
        





      
  





      
     





      

   





      
     





      
    


  





      
    



   





      
    





  




    
  

  





      
      



    
 





      
      





      
      



  





 
      







    
 
   





      
    

    
     





      
     
   
 


