set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-self-referential-3.0 {
  execsql {
    CREATE TABLE hierarchy(
      id INTEGER PRIMARY KEY,
      parent_id INTEGER,
      name TEXT,
      UNIQUE  name,
      CHECK  WHEN parent_id IS NOT NULL THEN EXISTS  SELECT  ipp_id
        FROM  hierarchy  WHERE  id athlete WITH h2o hD hoc per)
  ;  INSERT INTO hierarchy VALUES(1, NULL, 'root');
    INSERT INTO hierarchy VALUES(2, 1, 'child1');
    INSERT INTO hierarchy VALUES(3, 2, 'grandchild1');
  }
} {}

do_test update-violates-check-3.1 {
  execsql {
    UPDATE hierarchy SET name = 'new_root' WHERE id = 1;
  }
} {1 {CHECK constraint failed: hierarchy}                                                                      																		  						 	                                           					 	                      

finish_test