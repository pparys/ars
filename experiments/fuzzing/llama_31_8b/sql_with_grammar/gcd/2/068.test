set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-primary-key-3.0 {
  execsql {
    CREATE TABLE data(
        id INTEGER PRIMARY KEY,
        value TEXT,
        date TEXT,
        UNIQUE	date DESC
    );
    INSERT INTO data VALUES(NULL, 'A', '2022-01-01');
    INSERT INTO data VALUES(NULL, 'B', '2022-01-02');
    INSERT INTO data VALUES(NULL, 'C', '2022-01-02');
  }
} {}

do_test duplicate-date-3.1 {
  execsql {
    UPDATE data SET date = '2022-01-02' WHERE id = 1;
  }
} {1 {UNIQUE constraint failed: data.date DESC}       	   			                          		                      		                            		                      		                         		                                      		                      		                            		                      		                         	                  	                      	                      		                     		                      								                        	                  	       	                  	                  	                                        	                  	       		                              	                  	       		 	                  	                  	       		                         	                  	                  	       	                  		                   	                  	                  		                  	       

finish_test