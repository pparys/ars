set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-data-3.0 {
  execsql {
    CREATE TABLE employees(
      id INTEGER PRIMARY KEY,
      name TEXT NOT NULL,
      email TEXT UNIQUE,
      manager_id INTEGER,
      constraint fk_manager_id REFERENCES employees ON DELETE SET NULL
    );
    INSERT INTO employees(id, name, email, manager_id) VALUES
      (1, 'John', 'john@example.com', NULL);
    INSERT INTO employees(id, name, email, manager_id) VALUES
      (2, 'Alice', 'alice@example.com', 1);
    INSERT INTO employees(id, name, email, manager_id) VALUES
      (3, 'Bob', 'bob@example.com', 1);
  }
} {}

do_test update-foreign-key-3.1 {
  execsql {
    UPDATE employees SET manager_id = 2 WHERE id = 1;
  }
} {1 {FOREIGN KEY constraint failed: employees.manager_id,}  	                                                        
 finish_test