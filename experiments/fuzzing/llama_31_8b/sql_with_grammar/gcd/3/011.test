set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-foreign-key-2.1 {
  execsql {
    CREATE TABLE parent(id INTEGER PRIMARY KEY);
    CREATE TABLE child(id INTEGER PRIMARY KEY AUTOINCREMENT, pid INTEGER, CHECK EXISTS 
    SELECT  EXISTS FROM parent WHERE id  IF NOT EXISTS pid) ;
    INSERT INTO parent VALUES(1);
    INSERT INTO child VALUES(1,1);
  }
} {}

do_test update-violates-check-2.2 {
  execsql {
    UPDATE child SET pid = NULL
  ;}
} {2 { CHECK constraint failed: child }   						
finish_test