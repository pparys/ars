set testdir [file dirname $argv0]
source $testdir/tester.tcl

do_test setup-table-1.0 {
  execsql {
    CREATE TABLE products(pk INTEGER PRIMARY KEY, name TEXT UNIQUE, price REAL);
  CREATE TABLE orders(pk INTEGER PRIMARY KEY, product INTEGER, quantity INTEGER, FOREIGN KEY product REFERENCES products);
  INSERT INTO products VALUES(1, 'Product A', 10.99);
  INSERT INTO orders VALUES(101, 1, 2);
  INSERT INTO orders VALUES(102, 1, 3);
  }
} {}

do_test group-by-order-1.1 {
  execsql {
    SELECT *
    FROM orders
    WHERE product = 1
    ORDER BY id DESC
    LIMIT 1
    ;
    SELECT SUM_quantity FROM orders
    WHERE product = 1
    GROUP BY product
    ORDER BY SUM_quantity DESC
    LIMIT 1
    ;
  }
} {2 102}

finish_test